<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <link rel="stylesheet" href="../assets/css/all.min.css">

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
</head>

<body>

    <div class="header">
        <nav>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Services</a></li>
                <li><a href="#">Contact</a></li>
            </ul>

            <div class="action">
                <div class="profile" onclick="menuToggle();">
                    <img src="../assets/images/s2.jpg" alt="">
                </div>

                <div class="menu">
                    <h3 class="username">User</h3>
                    <ul>
                        <li>
                            <i class="fa-solid fa-user"></i>
                            <a href="user-profile.html" id="profile-link"> User Profile</a>
                        </li>
                        <li>
                            <i class="fa-solid fa-right-from-bracket"></i>
                            <a href="#" id="logout-link"> Logout </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="dashboard-container">
            <h2 class="top">Dashboard Menu</h2>

            <div class="page-container" id="pageContainer">
                <!-- Pages will be dynamically added here -->
            </div>

            <div id="dashboard-info">
                <!-- Dashboard information will be displayed here -->
            </div>
        </div>
    </div>

    <script type="text/javascript" src="../js/main.js"></script>

    <script>
        function menuToggle() {
            const toggleMenu = document.querySelector('.menu');
            toggleMenu.classList.toggle('active')
        }

        function logout() {
            let confirmLogout = confirm("Are you sure you want to log out?");
            if (confirmLogout) {
                window.location.href = "index.html";
            } else {
                console.log("Logout canceled.");
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            const logoutLink = document.getElementById("logout-link");
            if (logoutLink) {
                logoutLink.addEventListener("click", function (e) {
                    e.preventDefault();
                    logout();
                });
            }

            const userProfileLink = document.getElementById("profile-link");
            if (userProfileLink) {
                userProfileLink.addEventListener("click", function (e) {
                    e.preventDefault();
                    window.location.href = "user-profile.html";
                });
            }

            function getCookie(name) {
                const cookies = document.cookie.split(';').map(cookie => cookie.trim());
                for (const cookie of cookies) {
                    const [cookieName, cookieValue] = cookie.split('=');
                    if (cookieName === name) {
                        return cookieValue;
                    }
                }
                return null;
            }

            const token = getCookie('token');

            console.log("Token from Cookie:", token);

            if (!token) {
                console.error('Token not found in the cookie.');
                return;
            }

            const apiUrl = `${baseUrl}dashboard.php?token=${token}`;
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data && data.styling_data) {
                        console.log("Dashboard API Response:", data);

                        const dashboardInfo = document.getElementById("dashboard-info");
                        const buttonsContainer = document.createElement("div");
                        buttonsContainer.classList.add("button-container");

                        data.styling_data.forEach(buttonInfo => {
                            const button = document.createElement("button");

                            button.textContent = buttonInfo.stylestring;
                            button.style.backgroundColor = buttonInfo.color;
                            button.style.width = getSizeValue(buttonInfo.size);
                            button.style.height = getSizeValue(buttonInfo.size);
                            button.style.border = "none";
                            button.style.margin = "10px";
                            button.style.fontSize = "15px";
                            button.style.fontWeight = "bold";

                            button.addEventListener("mouseenter", function () {
                                button.style.backgroundColor = "#ff5733";
                                console.log(buttonInfo.stylestring);
                            });

                            button.addEventListener("mouseleave", function () {
                                button.style.backgroundColor = buttonInfo.color;
                            });

                            buttonsContainer.appendChild(button);

                            button.addEventListener("click", function () {
                                if (buttonInfo.stylestring === 'فاتورة بيع') {
                                    console.log("Redirecting to user-profile.html");
                                    // window.location.href = "user-profile.html";
                                } else {
                                }
                            });
                        });

                        if (data.user_name) {
                            var h3Element = document.querySelector('.username');
                            h3Element.innerHTML = "Hello " + data.user_name + " :)";
                        }

                        dashboardInfo.appendChild(buttonsContainer);

                        setupGrid(data.styling_data.length, buttonsContainer);
                    } else if (data && data.error) {
                        console.error('Error fetching dashboard data:', data.error);
                        alert('No dashboard data in the database');
                    } else {
                        console.error('Unexpected response format:', data);
                    }
                })
                .catch(error => {
                    console.error('Error fetching dashboard data:', error);
                });

                const staticPages = ['Page 1', 'Page 2', 'Page 3', 'Page 4'];


            // Dynamic creation of page elements based on the API response
            const pageContainer = document.getElementById('pageContainer');
            data.page.forEach((pageName) => {
                const pageElement = document.createElement('h2');
                pageElement.textContent = pageName;
                pageContainer.appendChild(pageElement);
            });
        });

        function getSizeValue(size) {
            switch (size.toLowerCase()) {
                case 's':
                    return '120px';
                case 'm':
                    return '180px';
                case 'l':
                    return '200px';
                default:
                    return '180px';
            }
        }

        function setupGrid(columns, container) {
            const screenWidth = window.innerWidth;
            if (screenWidth <= 900) {
                container.style.gridTemplateColumns = 'repeat(5, 1fr)';
            } else {
                container.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
            }
        }
    </script>
</body>

</html>
