<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/all.min.css">

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
</head>

<body>

    <div class="header">
        <nav>

            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Services</a></li>
                <li><a href="#">Contact</a></li>

            </ul>


            <div class="action">

                <div class="profile" onclick="menuToggle();">
                    <img src="../img/s2.jpg" alt="">
                </div>


                <div class="menu">
                    <h3 class="username">User</h3>
                    <ul>
                        <li>
                            <i class="fa-solid fa-user"></i>
                            <!-- Set the href attribute to the target page -->
                            <a href="user-profile.html" id="profile-link"> User Profile</a>
                        </li>
                        <li>
                            <i class="fa-solid fa-envelope"></i>
                            <a href="#" id="message-link"> Message </a>
                        </li>
                        <li>
                            <i class="fa-solid fa-gear"></i>
                            <a href="#" id="settings-link"> Settings </a>
                        </li>
                        <li>
                            <i class="fa-solid fa-circle-info"></i>
                            <a href="#" id="help-link"> Help </a>
                        </li>
                        <li>
                            <i class="fa-solid fa-right-from-bracket"></i>
                            <a href="#" id="logout-link"> Logout </a>
                        </li>


                    </ul>


                </div>
            </div>

        </nav>

        <div class="dashboard-container">
            <h2 class="top">Dashboard Menu</h2>

            <div id="dashboard-info">
                <!-- Dashboard information will be displayed here -->
            </div>
        </div>

    </div>

    <!-- <img class="wave" src="../img/wave.png"> -->

    <script type="text/javascript" src="../js/main.js"></script>

    <script>

        function menuToggle() {
            const toggleMenu = document.querySelector('.menu');
            toggleMenu.classList.toggle('active')
        }

        function logout() {
            let confirmLogout = confirm("Are you sure you want to log out?");
            if (confirmLogout) {
                window.location.href = "index.html";
            } else {
                console.log("Logout canceled.");
            }
        }

        document.addEventListener("DOMContentLoaded", function () {

            const logoutLink = document.getElementById("logout-link");
            if (logoutLink) {
                logoutLink.addEventListener("click", function (e) {
                    e.preventDefault();
                    logout();
                });
            }

            const userProfileLink = document.getElementById("profile-link");
            if (userProfileLink) {
                userProfileLink.addEventListener("click", function (e) {
                    e.preventDefault();
                    window.location.href = "user-profile.html";
                });
            }

            function getCookie(name) {
                const cookies = document.cookie.split(';').map(cookie => cookie.trim());
                for (const cookie of cookies) {
                    const [cookieName, cookieValue] = cookie.split('=');
                    if (cookieName === name) {
                        return cookieValue;
                    }
                }
                return null;
            }

            const token = getCookie('token');

            console.log("Token from Cookie:", token);

            if (!token) {
                console.error('Token not found in the cookie.');
                return;
            }

            const apiUrl = `${baseUrl}dashboard.php?token=${token}`;
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data && data.buttons) {
                        console.log("Dashboard API Response:", data);

                        const dashboardInfo = document.getElementById("dashboard-info");
                        const buttonsContainer = document.createElement("div");
                        buttonsContainer.classList.add("button-container");

                        data.buttons.forEach(buttonInfo => {
                            const button = document.createElement("button");
                            button.textContent = buttonInfo.string;
                            button.style.backgroundColor = buttonInfo.color;
                            button.style.width = "120px";
                            button.style.height = "120px";
                            button.style.border = "none";
                            button.style.margin = "10px";
                            button.style.fontSize = "40px";
                            button.style.marginTop = "30px";

                            button.addEventListener("mouseenter", function () {
                                button.style.backgroundColor = "#ff5733";
                            });

                            button.addEventListener("mouseleave", function () {
                                button.style.backgroundColor = buttonInfo.color;
                            });

                            buttonsContainer.appendChild(button);
                        });

                        if (data.user_name) {
                            var h3Element = document.querySelector('.username');
                            h3Element.innerHTML = "Hello " + data.user_name + " :)";
                        }

                        dashboardInfo.appendChild(buttonsContainer);
                    } else if (data && data.error) {
                        console.error('Error fetching dashboard data:', data.error);
                        alert('No dashboard data in the database');
                    } else {
                        console.error('Unexpected response format:', data);
                    }
                })
                .catch(error => {
                    console.error('Error fetching dashboard data:', error);
                });

        });
    </script>
</body>

</html>
